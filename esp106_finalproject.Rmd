---
title: "ESP106_Final-Project"
author: "Madalyn Papenfuss"
date: "2023-03-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
# packages <- do if thing
# tidyverse
# terra
# ggplot2
# dplyr
# tidyr
```


url <- download.file
base name url (if does not exist and unzip)

## R Markdown

```{r, include=FALSE}
URL <- "https://gis.data.ca.gov/datasets/89f0a301dcdd44f5900c4eb501af0a7f_0/about"
zipfile <- file.path(FILENAME, basename(URL))
if (!file.exists(zipfile)) {
  download.file(URL, zipfile)
}
```

#LANDUSE DATA FOR SJ USING SHP
```{r delta map}
#ASK HOW TO DOWNLOAD FROM SITE (ASK HOW)
# https://gis.data.ca.gov/datasets/89f0a301dcdd44f5900c4eb501af0a7f_0/about
library(terra)
setwd("C:/Users/maddi/OneDrive/Desktop/R files/final project")
sanjoaquincroplandvect <- vect("C:/Users/maddi/OneDrive/Desktop/R files/final project/i15_LandUse_SanJoaquin2017/i15_LandUse_SanJoaquin2017.shp")
#getting plants and # of acres
sjclv <- sanjoaquincroplandvect[[c("CROPTYP1","ACRES")]]
#sum all acres for single plant
sjclv<- aggregate(.~CROPTYP1,data=sjclv,sum)
#order dataset from high to low
sjclv <- sjclv[order(sjclv$ACRES, decreasing = TRUE), ]
#top 15 acres for ag land use
sjclv <- sjclv[1:15,]
sjclv$landusenames <- c("Native Vegetation","Vineyard", "Grain and Hay", "Almonds", "Walnuts", "Urban", "Corn", "Alfalfa/alfalfa mixtures", "Semi-Ag Misc", "Water Surface","Tomatoes", "Cherries", "Pasture", "Urban Residential", "Paved Areas") 
#barplot of crop by acre 
par(mar=c(5,6.6,3,1))
barplot(sjclv$ACRES, names.arg=sjclv$landusenames, horiz = TRUE, las=1, cex.names = 0.7, col="darkblue")
title(xlab = "Acres", main="Landuse in San Joaquin County")  
#possibly add color to only crop ones, or change color in general
#axis needs to be closer (ASK HOW)
```

#SJ SPATIAL MAP
```{r, echo=FALSE}
#ADD LEGEND
#only using first letter
sanjoaquincroplandvect <- vect("C:/Users/maddi/OneDrive/Desktop/R files/final project/i15_LandUse_SanJoaquin2017/i15_LandUse_SanJoaquin2017.shp")
sanjoaquincroplandvect$CROPTYP1 <- substr(sanjoaquincroplandvect$CROPTYP1, 0, 1)
csj <- c("darkgreen", "lightpink1", "grey", "tomato1", "#00b7c7", "chocolate4", "darkgoldenrod2","wheat2","#FF8800", "darkorchid3", "#22AA99", "darkseagreen")
#creating a table with the letter (from data table) and general land use informations (from website) and given color

usj <- unique(sanjoaquincroplandvect$CROPTYP1)
glunames <-c("Natural Space", "Semi-Ag Farmuse", "Urban", "Field Crops", "Truck Crops","Pasture",  "Grain and Hay", "Idle", "Deciduous Fruit/Nuts", "Vineyards", "Rice", "Citrus & Subtropical")
ucsj <- data.frame(CROPTYP1=usj, col=csj, glnames=glunames)
sanjoaquincroplandvect <- merge(sanjoaquincroplandvect, ucsj, by = "CROPTYP1")
unique(sanjoaquincroplandvect$col)

plot(sanjoaquincroplandvect, "glnames", col=sanjoaquincroplandvect$col, border = NA)

plot(sanjoaquincroplandvect, col=sanjoaquincroplandvect$col, border=NA)
plot(sanjoaquincroplandvect, col=sanjoaquincroplandvect$col, border=NA) + legend(legend = sanjoaquincroplandvect$glnames, fill = sanjoaquincroplandvect$col, border = "black")
```

#MORE GENERAL LANDUSE TYPES FOR SJ USING CSV
```{r}
#make land use type "more general"
sjcropland <- sanjoaquincroplandvect[[c("CROPTYP1","ACRES")]]
sjcgeneral <- aggregate(.~CROPTYP1,data=sjcropland,sum)
sjcgeneral$CROPTYP1 <- substr(sjcgeneral$CROPTYP1, 0, 1)
sjcgeneral <- aggregate(.~CROPTYP1,data=sjcgeneral,sum)
sjcgeneral <- sjcgeneral[order(sjcgeneral$ACRES, decreasing = TRUE), ]
sjcgeneral$landusenames <- c("Natural Space", "Deciduous Fruit/Nuts", "Urban", "Vineyards", "Grain and Hay", "Pasture", "Field Crops", "Semi-Ag Farmuse", "Truck Crops","Idle", "Citrus & Subtropical", "Rice")
par(mar=c(5,7,3,2))
barplot(sjcgeneral$ACRES, names.arg=sjcgeneral$landusenames, horiz = TRUE, las=1,cex.names = 0.75, col="darkblue", xlab = "Acres", main="General Land Use in San Joaquin County", xlim=c(0,200000)) 
```



#TYPE OF IRRIGATION PER ACRE
```{r, echo=FALSE}
#subset data based on irrigation/not, irrigation method, crop type, and acreage 
sjirrigation <- sanjoaquincroplandvect[[c("IRR_TYP1PA","IRR_TYP1PB","CROPTYP1", "ACRES")]]
unique(sjirrigation$IRR_TYP1PB)


#COLOR FOR EACH IRRIGATIONTYPE 
sjcol <- c("#ffee65", "#b30000", "#7c1158", "#4421af", "#fdcce5", "#1a53ff", "#0d88e6", "#DD4477", "#00b7c7", "chocolate4", "#8be04e", "#b3d4ff", "#9b19f5","#FF9900", "#22AA99", "#E67300")
sju <- unique(sjirrigation$IRR_TYP1PB)
sjucol <- data.frame(IRR_TYP1PB=sju, col=sjcol)
sjirrigation <- merge(sjirrigation, sjucol, by = "IRR_TYP1PB")
unique(sjirrigation$IRR_TYP1PB)

#removing Non-Irrigated Areas ("n") & Unknown Values ("U")
sjirrigation <- sjirrigation[!grepl('n', sjirrigation$IRR_TYP1PA),]
unique(sjirrigation$IRR_TYP1PB)
sjirrigation <- sjirrigation[!grepl('U', sjirrigation$IRR_TYP1PB),]
unique(sjirrigation$IRR_TYP1PB)
#RENAME IRRIGATION
#CAN I TURN THIS INTO A FOR LOOP EVEN IF DATA IS NOT THERE
#HOW TO DOWNLOAD W THAT DATA
#ASK JUDY, RENAME IRRIGATION TYPES <- ASK HOW TO DOWNLOAD FILE W NAMES BC ITS ON WEBSITE 
sjirrigation[sjirrigation == "A"] <- "Buried Drip"
sjirrigation[sjirrigation == "B"] <- "Border Strip"
sjirrigation[sjirrigation == "C"] <- "Center Pivot Sprinkler"
sjirrigation[sjirrigation == "D"] <- "Surface Drip"
sjirrigation[sjirrigation == "F"] <- "Furrow"
sjirrigation[sjirrigation == "H"] <- "Hand Move Sprinkler"
sjirrigation[sjirrigation == "L"] <- "Linear Move Sprinkler"
sjirrigation[sjirrigation == "M"] <- "Micro Sprinkler"
sjirrigation[sjirrigation == "N"] <- "Basin"
sjirrigation[sjirrigation == "P"] <- "Permanent Sprinkler"
sjirrigation[sjirrigation == "R"] <- "Side Roll Sprinkler"
sjirrigation[sjirrigation == "S"] <- "Subirrigation"
sjirrigation[sjirrigation == "T"] <- "Solid Set Sprinkler"
sjirrigation[sjirrigation == "U"] <- "Irrigated, unknown or not mapped"
sjirrigation[sjirrigation == "W"] <- "Wild Flooding"
library(ggplot2)
ggplot(data = sjirrigation, aes(x = IRR_TYP1PB, y = ACRES)) +
    geom_bar(stat="identity", color=sjirrigation$col,fill=sjirrigation$col) + coord_flip() + ggtitle("Irrigation Method per Acre")+ ylab("Acres") + xlab("Irrigation Method") + theme_bw()
#generate table - use merge 
```

#TOP CROP IRRIGATION PATTERN
```{r, echo=FALSE}
#subset data based on irrigation type and crop type
sanjoaquincroplandvect <- vect("C:/Users/maddi/OneDrive/Desktop/R files/final project/i15_LandUse_SanJoaquin2017/i15_LandUse_SanJoaquin2017.shp")
sjcropirrigation <- sanjoaquincroplandvect[[c("IRR_TYP1PA","IRR_TYP1PB","CROPTYP1", "ACRES")]]
#getting rid of non irrigated rows
sjcropirrigation <- sjcropirrigation[!grepl('n', sjcropirrigation$IRR_TYP1PA),]
#getting rid of "Unknown"
unique(sjcropirrigation$IRR_TYP1PB)
sjcropirrigation <- sjcropirrigation[!grepl('U', sjirrigation$IRR_TYP1PB),]
unique(sjcropirrigation$IRR_TYP1PB)
# sjcropirrigation2$Col <- c("#b30000","#7c1158",  "#4421af", )
#filter by certain "main" crops - gathered from most acre/crop   NEED TO ADD G
library(dplyr)
sjj <- filter(sjcropirrigation, CROPTYP1 %in% c("V", "D13", "D12", "F6","P1","T15","D3", "P3", "G"))
unique(sjj$CROPTYP1)
#ASK JUDY, RENAME IRRIGATION TYPES <- ASK HOW TO DOWNLOAD FILE W NAMES BC ITS ON WEBSITE 
sjj[sjj == "A"] <- "Buried Drip"
sjj[sjj == "B"] <- "Border Strip"
sjj[sjj == "C"] <- "Center Pivot Sprinkler"
sjj[sjj == "D"] <- "Surface Drip"
sjj[sjj == "F"] <- "Furrow"
sjj[sjj == "H"] <- "Hand Move Sprinkler"
sjj[sjj == "L"] <- "Linear Move Sprinkler"
sjj[sjj == "M"] <- "Micro Sprinkler"
sjj[sjj == "N"] <- "Basin"
sjj[sjj == "P"] <- "Permanent Sprinkler"
sjj[sjj == "S"] <- "Subirrigation"
sjj[sjj == "T"] <- "Solid Set Sprinkler"
sjj[sjj == "U"] <- "Irrigated, unknown or not mapped"
sjj[sjj == "W"] <- "Wild Flooding"
#Distribution of irrigation type per crop
ggplot(data=sjj, aes(x=CROPTYP1, y=ACRES, fill=IRR_TYP1PB)) + geom_bar(stat="identity") + theme_bw() + ggtitle("Irrigation Method per Crop") + scale_fill_manual(values=c("yellow3", "#b30000", "#7c1158", "#4421af", "#1a58f2", "#DD4477", "#00b7c7", "darkgreen","#0d88e2", "#8be04e", "#b3d4ff", "#9b19f5","#FF9900", "#fdcce5", "blue4", "magenta", "red", "aquamarine")) + scale_x_discrete(labels=c('Almond', 'Walnut', 'Cherry', 'Corn', "Grain/\n Hay", "Alfalfa/ \n mixtures", "Pasture","Tomato", "Vineyard"))
```
#rename columns & reorg data

```{r, echo=FALSE}
url <- "https://cadwr.box.com/s/n6ze2ns8d9gy70ds7wj0d8zcv97i1c9y"
destfile <- "C:/Users/maddi/OneDrive/Desktop/R files/final project"
download.file(url, destfile)


URL <- "https://cadwr.box.com/s/n6ze2ns8d9gy70ds7wj0d8zcv97i1c9y"
zipfile <- file.path(wateruse, basename(URL))
if (!file.exists(zipfile)) {
  download.file(URL, zipfile)
}
```

https://cadwr.box.com/s/n6ze2ns8d9gy70ds7wj0d8zcv97i1c9y
URL <- "https://gis.data.ca.gov/datasets/89f0a301dcdd44f5900c4eb501af0a7f_0/about"
zipfile <- file.path(FILENAME, basename(URL))
if (!file.exists(zipfile)) {
  download.file(URL, zipfile)
}



```{r, echo=FALSE}
#   Acres of x crop
# maybe graph with color by graph 
# change graph type to like sand fill one? idk 
#HOW TO DOWNLOAD THIS ONE HELP
wateruse <- read.csv("C:/Users/maddi/OneDrive/Desktop/R files/final project/DELTA_WaterPlanWaterUseData.csv")
wateruse <- wateruse[,4:22]
#Water Use for SJ County
sjwateruse <- subset(wateruse, wateruse$County == "39_San Joaquin")
#wateruse by crop for SJ county
library(tidyverse)
sjwateruse %>% 
  select(-County) %>% 
pivot_longer(cols = names(.)) %>% 
ggplot(aes(x = value, y = "", fill = name)) +
  labs(title = "Water Use by Crop Type") +
  geom_col(position = "stack") + coord_polar() + scale_fill_manual(values=c("yellow3", "#b30000", "#7c1158", "#4421af", "#1a58f2", "#DD4477", "#00b7c7", "darkgreen","#0d88e2", "#8be04e", "#b3d4ff", "#9b19f5","#FF9900", "#fdcce5", "blue4", "magenta", "red", "aquamarine")) + theme_void()

```

#isolate a specific county and identify variables about the land

#rename columns & reorg data
```{r, echo=FALSE}
etawwateruse <- read.csv("C:/Users/maddi/OneDrive/Desktop/R files/final project/ETaw_WaterPlanWaterUseData.csv")
sjetawwateruse <- subset(etawwateruse, etawwateruse$County == "39_San Joaquin")
sjetawwateruse <- sjetawwateruse[,5:24]
library(tidyr)
sjetawwateruse <- gather(sjetawwateruse, crop, value,na.rm = FALSE, convert = FALSE)
library(ggplot2)
ggplot(sjetawwateruse, aes(x= crop, y= value, fill=value)) +
  geom_bar(position="dodge",  stat="identity")  + coord_flip() + theme_bw() + ggtitle("ETa Water Use By Crop ")+ ylab("Etaw (Acre-ft/Acre)") + xlab("Crop Type")
```

```{r, echo=FALSE}
appliedwateruse <- read.csv("C:/Users/maddi/OneDrive/Desktop/R files/final project/AppliedWater by Acre_WaterPlanWaterUseData.csv")
appliedwateruse <- subset(appliedwateruse, appliedwateruse$County == "39_San Joaquin")
appliedwateruse <- appliedwateruse[,5:24]
#Water Use for SJ County
library(tidyr)
appliedwateruse <- gather(appliedwateruse, crop, value,na.rm = FALSE, convert = FALSE)
library(ggplot2)
ggplot(appliedwateruse, aes(x= crop, y= value, fill=value)) +
  geom_bar(position="dodge",  stat="identity")  + coord_flip() + theme_bw() + ggtitle("Applied Water per Acre by Crop Type")+ ylab("Applied Water (Acre-ft/Acre)") + xlab("Crop Type")
```

```{r, echo=FALSE}
minus <- appliedwateruse$value -  sjetawwateruse$value
name <- c("Grain", "Rice", "Cotton", "Sugar.Beets", "Corn", "Dry.Beans", "Safflower", "Other.Field.Crops", "Alfalfa", "Pasture", "Tomato.Processing", "Tomato.Fresh", "Cucurbits", "Onions...Garlic", "Potatoes", "Truck.Crops", "Almonds...Pistachios", "Other.Deciduous", "Citrus...Subtropical", "Vineyard")
marks <- list(minus)
waterdata <- data.frame(unlist(name),unlist(marks))
names(waterdata) <- c("Crop","Value")
#to name the columns we use names() function
ggplot(waterdata, aes(x= Crop, y= Value, fill=Value)) + geom_bar(position="dodge", stat="identity")  + coord_flip() + theme_bw()+ ggtitle("Inefficiency of Irrigation Method by Crop")+ ylab("Difference between Applied - Etaw") + xlab("Crop Type")
```

```{r, echo=FALSE}
minus2 <- sjetawwateruse$value - appliedwateruse$value
name <- c("Grain", "Rice", "Cotton", "Sugar.Beets", "Corn", "Dry.Beans", "Safflower", "Other.Field.Crops", "Alfalfa", "Pasture", "Tomato.Processing", "Tomato.Fresh", "Cucurbits", "Onions...Garlic", "Potatoes", "Truck.Crops", "Almonds...Pistachios", "Other.Deciduous", "Citrus...Subtropical", "Vineyard")
marks <- list(minus2)
waterdata <- data.frame(unlist(name),unlist(marks))
names(waterdata) <- c("Crop","Value")
  
#to name the columns we use names() function
ggplot(waterdata, aes(x= Crop, y= Value, fill=Value)) + geom_bar(position="dodge", stat="identity")  + coord_flip() + theme_bw()+ ggtitle("Inefficiency of Irrigation Method by Crop")+ ylab("Difference between Etaw - Applied") + xlab("Crop Type")
```
